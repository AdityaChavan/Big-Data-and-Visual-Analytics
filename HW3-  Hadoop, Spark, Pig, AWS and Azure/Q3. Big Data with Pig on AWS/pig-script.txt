bigrams = LOAD 's3://cse6242-2018spring-aws-big/*' AS (bigram:chararray, year:int, occurrences:int, books:int);
filtered = FILTER bigrams BY (occurrences >= 400) AND (books >= 8);
grouped = GROUP filtered BY bigram;
generated = FOREACH grouped GENERATE $0 AS first,ROUND((double)SUM(filtered.occurrences)/(double)SUM(filtered.books)*100.0)/100.0 AS second;
ordered = ORDER generated BY second DESC, first ASC;
filtered2 = LIMIT ordered 15;
STORE filtered2 INTO 's3://cse6242-achavan7/output-big' using PigStorage ('\t');